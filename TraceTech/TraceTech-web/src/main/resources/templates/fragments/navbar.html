<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<body>

<nav th:fragment="navbar" class="navbar">
    <div class="nav-left">
        <a class="brand" th:href="@{/}">
            <img th:src="@{/img/tracetech-logo.png}" alt="TraceTech" class="logo">
            <span class="brand-text">TraceTech</span>
        </a>

        <a th:href="@{/tickets}">Tickets</a>
        <a th:href="@{/tickets/new}">Nuevo</a>

        <span th:if="${#authorization.expression('hasAnyRole(''ADMIN'',''TECH'')')}">
            <a th:href="@{/tickets/mine}">Mis asignados</a>
        </span>

        <a th:href="@{/tickets/my-created}">Mis creados</a>

        <span th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
            <a th:href="@{/admin/users}">Usuarios</a>
        </span>

        <a th:href="@{/about}">Sobre</a>
    </div>

    <div class="nav-right">

        <!-- No autenticado -->
        <span th:if="${#authorization.expression('isAnonymous()')}" class="nav-auth">
            <a th:href="@{/login}">Login cliente</a>
            <a th:href="@{/staff/login}">Login staff</a>
            <a th:href="@{/register}">Crear cuenta</a>
        </span>

        <!-- Autenticado -->
        <div th:if="${#authorization.expression('isAuthenticated()')}" class="nav-user">

            <details class="user-menu">
                <summary class="user-pill" title="Opciones de cuenta">
                    <span th:text="${#authentication.name}">user</span>
                </summary>

                <div class="user-dropdown">
                    <a th:href="@{/account}">Mi perfil</a>
                    <a th:href="@{/account/password}">Cambiar contrase√±a</a>
                </div>
            </details>

            <!-- Logout separado -->
            <form th:action="@{/logout}" method="post" class="logout-form">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit" class="logout-btn">Salir</button>
            </form>
        </div>

    </div>
</nav>

</body>
</html>
